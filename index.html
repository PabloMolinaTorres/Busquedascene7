<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Verificador de Fotos</title>
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Lato', sans-serif;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #fff;
        }
        .container {
            display: flex;
            height: 100%;
            width: 100%;
        }
        .leftMenu {
            width: 320px;
            height: 100vh;
            border-right: 1px solid #eeeeee;
            background-color: #fff;
            overflow-y: auto;
        }
        .leftMenu .intro {
            font-size: 12px;
            padding: 20px 20px 0;
        }
        .leftMenu textarea {
            width: calc(100% - 40px);
            border: 1px solid #eee;
            margin: 20px;
            height: calc(100% - 150px);
        }
        .leftMenu button {
            width: calc(100% - 40px);
            border: none;
            margin: 0 20px 20px;
            background-color: #8fca00;
            height: 50px;
            line-height: 50px;
            padding: 0;
            border-radius: 5px;
            color: white;
            font-size: 12px;
            letter-spacing: .075em;
            cursor: pointer;
        }
        .rightContainer {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #fff;
            position: relative;
        }
        .copy-button {
            position: absolute;
            top: 20px;
            right: 20px;
            border: none;
            background-color: #007bff;
            height: 40px;
            line-height: 40px;
            padding: 0 20px;
            border-radius: 5px;
            color: white;
            font-size: 12px;
            letter-spacing: .075em;
            cursor: pointer;
        }
        .error-list {
            padding: 20px;
            margin: 60px 20px 20px;
            border: 1px solid #eee;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .error-list div {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="leftMenu">
            <div class="intro">
                <div>Verificar imágenes desde:</div><br>
                <textarea name="skus" id="skus" cols="30" rows="10" placeholder="Ingresá los SKUs, uno debajo de otro sin comas"></textarea>
                <button id="buscar">VERIFICAR</button>
            </div>
        </div>
        <div class="rightContainer">
            <button class="copy-button" id="copiar">COPIAR</button>
            <div class="error-list" id="errorList">
                <!-- SKUs sin foto aparecerán aquí -->
            </div>
        </div>
    </div>
    <script>
        $('#buscar').click(function() {
            $('#errorList').empty();
            var skus = $('#skus').val().split('\n');
            var promises = [];
            skus.forEach(function(sku) {
                sku = sku.trim();
                if (sku !== "") {
                    promises.push(checkImage(sku));
                }
            });
            Promise.all(promises).then(function(results) {
                results.forEach(function(result) {
                    if (result.error) {
                        $('#errorList').append('<div>' + result.sku + '</div>');
                    }
                });
            });
        });

        $('#copiar').click(function() {
            var errores = [];
            $('#errorList div').each(function() {
                errores.push($(this).text());
            });
            var textoErrores = errores.join('\n');
            navigator.clipboard.writeText(textoErrores).then(function() {
                alert('SKUs copiados al portapapeles.');
            }, function(err) {
                console.error('Error al copiar al portapapeles: ', err);
            });
        });

        function checkImage(sku) {
            return new Promise(function(resolve) {
                var url = 'https://s7d5.scene7.com/is/image/Falabella/' + sku + '?scl=1&qlt=100,1&cache=off';
                console.log("Verificando imagen para SKU: " + sku + " desde URL: " + url);
                var img = new Image();
                img.src = url;
                img.alt = sku;
                img.onload = function() {
                    fetch(url, { method: 'HEAD' }).then(function(response) {
                        var contentLength = response.headers.get('content-length');
                        console.log("Tamaño de contenido para SKU " + sku + ": " + contentLength);
                        // Suponiendo que el tamaño de la imagen por defecto es 19698 bytes
                        if (contentLength == '19698') {
                            resolve({ error: true, sku: sku });
                        } else {
                            resolve({ error: false, sku: sku });
                        }
                    }).catch(function(error) {
                        console.error("Error al obtener el tamaño de la imagen para SKU: " + sku, error);
                        resolve({ error: true, sku: sku });
                    });
                };
                img.onerror = function() {
                    console.error("Error al cargar la imagen para SKU: " + sku);
                    resolve({ error: true, sku: sku });
                };
            });
        }
    </script>
</body>
</html>
