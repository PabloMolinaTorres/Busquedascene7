<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Renombrador Unificado</title>
    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #f4f4f4;
            padding: 20px;
            margin: 0;
        }
        .container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .sidebar {
            width: 20%;
            margin-right: 20px;
            position: sticky;
            top: 20px;
        }
        .instructions {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: left;
            font-size: 12px;
            color: #333;
            line-height: 1.4;
        }
        .instructions h2 {
            font-size: 14px;
            margin-bottom: 8px;
            color: #4CAF50;
        }
        .file-list, .url-list {
            width: 75%;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
            font-size: 12px; 
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #8fca00;
            color: white;
        }
        input[type="file"], textarea {
            width: 100%;
            margin-bottom: 20px;
            padding: 10px;
            font-size: 14px;
        }
        input[type="text"] {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 12px;
        }
        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .switch-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .switch-container button {
            padding: 10px 20px;
            border: none;
            background-color: #8fca00;
            color: white;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
        }
        .switch-container button.active {
            background-color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>Renombrador Unificado</h1>

    <div class="switch-container">
        <button id="localMode" class="active">Renombrar Archivos Locales</button>
        <button id="urlMode">Renombrar Imágenes desde URLs</button>
    </div>

    <div class="container">
        <!-- Renombrar archivos locales -->
        <div id="localForm" class="file-list active">
            <h2>Renombrar Archivos Locales</h2>
            <input type="file" id="fileUpload" multiple accept=".jpg,.jpeg,.png">
            <table>
                <thead>
                    <tr>
                        <th>Nombre de Archivo</th>
                        <th>Nuevo Renombre</th>
                    </tr>
                </thead>
                <tbody id="fileTable">
                    <!-- Filas generadas dinámicamente -->
                </tbody>
            </table>
            <button id="renameLocalButton" disabled>Renombrar y Descargar</button>
        </div>

        <!-- Renombrar imágenes desde URLs -->
        <div id="urlForm" class="url-list" style="display: none;">
            <h2>Renombrar Imágenes desde URLs</h2>
            <textarea id="skuInputLeft" placeholder="Ingrese SKUs, uno por línea"></textarea>
            <textarea id="skuInputRight" placeholder="Ingrese nuevos nombres, uno por línea"></textarea>
            <button id="renameUrlButton">Renombrar y Descargar</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.1.0/jszip-utils.min.js"></script>

    <script>
        const localModeButton = document.getElementById('localMode');
        const urlModeButton = document.getElementById('urlMode');
        const localForm = document.getElementById('localForm');
        const urlForm = document.getElementById('urlForm');
        const renameLocalButton = document.getElementById('renameLocalButton');
        const fileTable = document.getElementById('fileTable');
        const fileUpload = document.getElementById('fileUpload');
        const renameUrlButton = document.getElementById('renameUrlButton');

        let files = [];

        // Cambiar entre modos
        localModeButton.addEventListener('click', () => {
            localForm.style.display = 'block';
            urlForm.style.display = 'none';
            localModeButton.classList.add('active');
            urlModeButton.classList.remove('active');
        });

        urlModeButton.addEventListener('click', () => {
            localForm.style.display = 'none';
            urlForm.style.display = 'block';
            localModeButton.classList.remove('active');
            urlModeButton.classList.add('active');
        });

        // Función para renombrar archivos locales
        fileUpload.addEventListener('change', function() {
            files = Array.from(this.files);
            fileTable.innerHTML = '';
            files.forEach((file, index) => {
                const row = document.createElement('tr');
                const originalNameCell = document.createElement('td');
                const newNameCell = document.createElement('td');

                originalNameCell.textContent = file.name;

                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = 'Nuevo nombre para ' + file.name;

                newNameCell.appendChild(input);
                row.appendChild(originalNameCell);
                row.appendChild(newNameCell);
                fileTable.appendChild(row);
            });

            renameLocalButton.disabled = files.length === 0;
        });

        renameLocalButton.addEventListener('click', function() {
            const zip = new JSZip();
            const inputs = fileTable.querySelectorAll('input');

            inputs.forEach((input, index) => {
                const newName = input.value.trim() || files[index].name; // Usar el nombre original si no se ingresa uno nuevo
                zip.file(newName, files[index]);
            });

            zip.generateAsync({ type: 'blob' }).then(function(content) {
                saveAs(content, 'renombrados_local.zip');
            });
        });

        // Función para renombrar imágenes desde URLs
        renameUrlButton.addEventListener('click', function() {
            const skus = document.getElementById('skuInputLeft').value.split('\n');
            const renameSkus = document.getElementById('skuInputRight').value.split('\n');
            const zip = new JSZip();

            if (skus.length !== renameSkus.length) {
                alert('La cantidad de SKUs y nombres debe coincidir.');
                return;
            }

            skus.forEach((sku, index) => {
                const imgUrl = `https://example.com/images/${sku.trim()}.jpg`;
                JSZipUtils.getBinaryContent(imgUrl, function(err, data) {
                    if (err) {
                        console.error('Error al descargar imagen:', err);
                        return;
                    }
                    zip.file(renameSkus[index].trim() + '.jpg', data, { binary: true });
                    if (index === skus.length - 1) {
                        zip.generateAsync({ type: 'blob' }).then(function(content) {
                            saveAs(content, 'renombrados_url.zip');
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
